<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ultimate SQL Playground - Learn & Explore SQL</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sql.js@1.8.0/dist/sql-wasm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.7/lib/codemirror.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.7/mode/sql/sql.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.7/lib/codemirror.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
            background-color: #f5f9fc;
            color: #1a202c;
            line-height: 1.6;
            padding: 90px 0 24px;
            overscroll-behavior: none;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e5e5e5;
        }
        .nav-container {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
        }
        .navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            padding: 12px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 420px;
            max-width: 90%;
            transition: background 0.5s ease, box-shadow 0.5s ease, opacity 0.5s ease, width 0.3s ease;
        }
        .navbar.transparent {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            opacity: 0.3;
        }
        body.dark-mode .navbar {
            background: rgba(44, 44, 44, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        body.dark-mode .navbar.transparent {
            background: rgba(44, 44, 44, 0.05);
        }
        .navbar button {
            padding: 14px; /* Larger padding for navbar buttons */
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 12px;
            position: relative;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        .navbar button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        .navbar button:active {
            transform: scale(0.95);
        }
        .navbar button.active {
            background: linear-gradient(135deg, rgba(163, 207, 255, 0.7), rgba(200, 200, 200, 0.7));
            box-shadow: 0 0 15px rgba(163, 207, 255, 0.5);
            animation: fadeHighlight 0.5s ease forwards;
        }
        body.dark-mode .navbar button.active {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.7), rgba(150, 150, 150, 0.7));
            box-shadow: 0 0 15px rgba(74, 144, 226, 0.5);
        }
        .navbar button.active i {
            stroke: #1a202c;
        }
        body.dark-mode .navbar button.active i {
            stroke: #ffffff;
        }
        .navbar i {
            width: 24px;
            height: 24px;
            stroke: #1a202c;
            stroke-width: 2;
            transition: stroke 0.3s ease;
        }
        body.dark-mode .navbar i {
            stroke: #e5e5e5;
        }
        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            padding: 12px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: background 0.5s ease, opacity 0.5s ease;
        }
        .theme-toggle.transparent {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            opacity: 0.3;
        }
        body.dark-mode .theme-toggle {
            background: rgba(44, 44, 44, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        body.dark-mode .theme-toggle.transparent {
            background: rgba(44, 44, 44, 0.05);
        }
        .theme-toggle button {
            padding: 14px; /* Larger padding for theme toggle button */
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        .theme-toggle button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        .theme-toggle button:active {
            transform: scale(0.95);
        }
        .theme-toggle i {
            width: 24px;
            height: 24px;
            stroke: #1a202c;
            stroke-width: 2;
            transition: stroke 0.3s ease;
        }
        body.dark-mode .theme-toggle i {
            stroke: #e5e5e5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 16px;
        }
        .page {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .page.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .greeting {
            font-size: 34px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: fadeIn 0.8s ease forwards;
        }
        .greeting span {
            font-size: 26px;
        }
        body.dark-mode .greeting {
            color: #e5e5e5;
        }
        .description {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 24px;
            line-height: 1.8;
            max-width: 800px;
            animation: fadeIn 1s ease forwards;
        }
        body.dark-mode .description {
            color: #a0a0a0;
        }
        .sql-editor-section {
            margin-bottom: 48px;
        }
        .sql-editor-section h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a202c;
            animation: fadeIn 0.8s ease forwards;
        }
        body.dark-mode .sql-editor-section h2 {
            color: #e5e5e5;
        }
        .sql-editor {
            padding: 20px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.5s ease;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease forwards;
        }
        body.dark-mode .sql-editor {
            background: rgba(255, 255, 255, 0.05);
        }
        .sql-editor:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.15);
        }
        body.dark-mode .sql-editor:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .sql-editor .CodeMirror {
            height: 200px;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 14px;
        }
        body.dark-mode .sql-editor .CodeMirror {
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: #2d2d2d;
            color: #e5e5e5;
        }
        .sql-editor .buttons {
            display: flex;
            gap: 16px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        .sql-editor .buttons button {
            padding: 14px 32px; /* Larger padding for all buttons */
            font-size: 16px; /* Consistent font size */
            font-weight: 600; /* Slightly bolder text */
            border-radius: 20px; /* Rounded corners */
            border: none; /* Remove borders */
            cursor: pointer;
            transition: all 0.3s ease; /* Smooth transitions */
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            color: #1a202c;
        }
        body.dark-mode .sql-editor .buttons button {
            background: rgba(255, 255, 255, 0.05);
            color: #e5e5e5;
        }
        .sql-editor .buttons button:hover {
            transform: translateY(-3px); /* Lift effect on hover */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Consistent shadow */
            background: rgba(255, 255, 255, 0.2);
        }
        body.dark-mode .sql-editor .buttons button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .sql-editor .buttons button:active {
            transform: scale(0.98); /* Slight shrink on click */
        }
        .sql-editor .buttons .run-query {
            background: #34c759;
            color: #ffffff;
        }
        .sql-editor .buttons .run-query:hover {
            background: #2eb350;
        }
        .sql-editor .buttons .export-csv {
            background: #0a84ff;
            color: #ffffff;
        }
        .sql-editor .buttons .export-csv:hover {
            background: #096dd9;
        }
        .sql-editor .buttons .export-chart {
            background: #ff6b6b;
            color: #ffffff;
        }
        .sql-editor .buttons .export-chart:hover {
            background: #e55a5a;
        }
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 8px;
        }
        body.dark-mode .error-message {
            color: #ff6b6b;
        }
        .result-section {
            margin-bottom: 48px;
        }
        .result-section h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a202c;
            animation: fadeIn 0.8s ease forwards;
        }
        body.dark-mode .result-section h2 {
            color: #e5e5e5;
        }
        .result-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }
        .result-tabs button {
            padding: 14px 32px; /* Larger padding for all buttons */
            font-size: 16px; /* Consistent font size */
            font-weight: 600; /* Slightly bolder text */
            border-radius: 20px; /* Rounded corners */
            border: none; /* Remove borders */
            cursor: pointer;
            transition: all 0.3s ease; /* Smooth transitions */
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            color: #1a202c;
        }
        body.dark-mode .result-tabs button {
            background: rgba(255, 255, 255, 0.05);
            color: #e5e5e5;
        }
        .result-tabs button:hover {
            transform: translateY(-3px); /* Lift effect on hover */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Consistent shadow */
            background: rgba(255, 255, 255, 0.2);
        }
        body.dark-mode .result-tabs button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .result-tabs button:active {
            transform: scale(0.98); /* Slight shrink on click */
        }
        .result-tabs button.active {
            background: #34c759;
            color: #ffffff;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease forwards;
            display: block;
        }
        .result-chart {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease forwards;
        }
        body.dark-mode .result-table, body.dark-mode .result-chart {
            background: rgba(255, 255, 255, 0.05);
        }
        .result-table th, .result-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            font-size: 14px;
            color: #1a202c;
        }
        body.dark-mode .result-table th, body.dark-mode .result-table td {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #e5e5e5;
        }
        .result-table th {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        body.dark-mode .result-table th {
            background: rgba(255, 255, 255, 0.05);
        }
        .history-section {
            margin-bottom: 48px;
        }
        .history-section h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a202c;
            animation: fadeIn 0.8s ease forwards;
        }
        body.dark-mode .history-section h2 {
            color: #e5e5e5;
        }
        .history-item {
            padding: 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        body.dark-mode .history-item {
            background: rgba(255, 255, 255, 0.05);
        }
        .history-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.15);
        }
        body.dark-mode .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .history-item pre {
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #1a202c;
            max-width: 70%;
            white-space: pre-wrap;
            word-break: break-word;
        }
        body.dark-mode .history-item pre {
            color: #e5e5e5;
        }
        .history-item .buttons {
            display: flex;
            gap: 8px;
        }
        .history-item .buttons button {
            padding: 14px 32px; /* Larger padding for all buttons */
            font-size: 16px; /* Consistent font size */
            font-weight: 600; /* Slightly bolder text */
            border-radius: 20px; /* Rounded corners */
            border: none; /* Remove borders */
            cursor: pointer;
            transition: all 0.3s ease; /* Smooth transitions */
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            color: #1a202c;
        }
        body.dark-mode .history-item .buttons button {
            background: rgba(255, 255, 255, 0.05);
            color: #e5e5e5;
        }
        .history-item .buttons button:hover {
            transform: translateY(-3px); /* Lift effect on hover */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Consistent shadow */
            background: rgba(255, 255, 255, 0.2);
        }
        body.dark-mode .history-item .buttons button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .history-item .buttons button:active {
            transform: scale(0.98); /* Slight shrink on click */
        }
        .tutorial-section, .schema-section, .examples-section {
            margin-bottom: 48px;
        }
        .tutorial-section h2, .schema-section h2, .examples-section h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a202c;
            animation: fadeIn 0.8s ease forwards;
        }
        body.dark-mode .tutorial-section h2, body.dark-mode .schema-section h2, body.dark-mode .examples-section h2 {
            color: #e5e5e5;
        }
        .tutorial, .schema-table, .example-query {
            padding: 20px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.5s ease;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease forwards;
        }
        body.dark-mode .tutorial, body.dark-mode .schema-table, body.dark-mode .example-query {
            background: rgba(255, 255, 255, 0.05);
        }
        .tutorial:hover, .schema-table:hover, .example-query:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.15);
        }
        body.dark-mode .tutorial:hover, body.dark-mode .schema-table:hover, body.dark-mode .example-query:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .tutorial h3, .schema-table h3, .example-query h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a202c;
        }
        body.dark-mode .tutorial h3, body.dark-mode .schema-table h3, body.dark-mode .example-query h3 {
            color: #e5e5e5;
        }
        .tutorial p, .schema-table p, .example-query p {
            color: #6b7280;
            font-size: 15px;
            line-height: 1.6;
        }
        body.dark-mode .tutorial p, body.dark-mode .schema-table p, body.dark-mode .example-query p {
            color: #a0a0a0;
        }
        .tutorial pre, .schema-table pre, .example-query pre {
            background: rgba(0, 0, 0, 0.05);
            padding: 12px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #1a202c;
            overflow-x: auto;
            margin-top: 8px;
        }
        body.dark-mode .tutorial pre, body.dark-mode .schema-table pre, body.dark-mode .example-query pre {
            background: rgba(255, 255, 255, 0.05);
            color: #e5e5e5;
        }
        .tutorial .challenge {
            margin-top: 16px;
            padding: 12px;
            border-left: 4px solid #34c759;
            background: rgba(255, 255, 255, 0.05);
        }
        body.dark-mode .tutorial .challenge {
            background: rgba(255, 255, 255, 0.03);
        }
        .tutorial .challenge button {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            background: #0a84ff;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        .tutorial .challenge button:hover {
            background: #096dd9;
            transform: translateY(-2px);
        }
        .tutorial .challenge button:active {
            transform: scale(0.95);
        }
        .tutorial .solution {
            display: none;
            margin-top: 8px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #1a202c;
        }
        body.dark-mode .tutorial .solution {
            background: rgba(255, 255, 255, 0.05);
            color: #e5e5e5;
        }
        .example-query .run-button {
            padding: 14px 32px; /* Larger padding for all buttons */
            font-size: 16px; /* Consistent font size */
            font-weight: 600; /* Slightly bolder text */
            border-radius: 20px; /* Rounded corners */
            border: none; /* Remove borders */
            cursor: pointer;
            transition: all 0.3s ease; /* Smooth transitions */
            background: #34c759;
            color: #ffffff;
        }
        .example-query .run-button:hover {
            transform: translateY(-3px); /* Lift effect on hover */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); /* Consistent shadow */
            background: #2eb350;
        }
        .example-query .run-button:active {
            transform: scale(0.98); /* Slight shrink on click */
        }
        .schema-diagram {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 16px;
            animation: fadeIn 1s ease forwards;
        }
        body.dark-mode .schema-diagram {
            background: rgba(255, 255, 255, 0.05);
        }
        .schema-diagram svg {
            width: 100%;
            height: auto;
        }
        footer {
            text-align: center;
            margin-top: 24px;
            margin-bottom: 16px;
            color: #6b7280;
            font-size: 14px;
            animation: fadeIn 1s ease forwards;
        }
        body.dark-mode footer {
            color: #a0a0a0;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeHighlight {
            0% { background: rgba(255, 255, 255, 0.2); box-shadow: 0 0 5px rgba(163, 207, 255, 0.2); }
            50% { background: linear-gradient(135deg, rgba(163, 207, 255, 0.9), rgba(200, 200, 200, 0.9)); box-shadow: 0 0 20px rgba(163, 207, 255, 0.7); }
            100% { background: linear-gradient(135deg, rgba(163, 207, 255, 0.7), rgba(200, 200, 200, 0.7)); box-shadow: 0 0 15px rgba(163, 207, 255, 0.5); }
        }
        @media (max-width: 768px) {
            .nav-container {
                gap: 8px;
            }
            .navbar {
                width: 360px;
                padding: 10px 18px;
            }
            .container {
                padding: 16px;
            }
            .greeting {
                font-size: 28px;
            }
            .greeting span {
                font-size: 22px;
            }
            .description {
                font-size: 15px;
                max-width: 100%;
            }
            .sql-editor .buttons {
                flex-direction: column;
                gap: 12px;
            }
            .sql-editor .buttons button {
                padding: 12px 24px;
                font-size: 14px;
            }
            .sql-editor .CodeMirror {
                height: 150px;
            }
            .result-tabs {
                flex-direction: column;
            }
            .history-item pre {
                max-width: 60%;
            }
            .tutorial-section h2, .schema-section h2, .examples-section h2, .result-section h2, .history-section h2 {
                font-size: 20px;
            }
            .tutorial, .schema-table, .example-query {
                padding: 16px;
            }
            .result-table th, .result-table td {
                font-size: 13px;
                padding: 10px;
            }
        }
        @media (max-width: 480px) {
            .navbar {
                width: 300px;
                padding: 8px 16px;
            }
            .navbar button {
                padding: 8px;
            }
            .navbar i {
                width: 22px;
                height: 22px;
            }
            .theme-toggle {
                padding: 8px;
            }
            .theme-toggle i {
                width: 22px;
                height: 22px;
            }
            .greeting {
                font-size: 24px;
            }
            .greeting span {
                font-size: 20px;
            }
            .description {
                font-size: 14px;
            }
            .sql-editor .buttons button {
                padding: 10px 20px;
                font-size: 13px;
            }
            .sql-editor .CodeMirror {
                height: 120px;
            }
            .history-item pre {
                max-width: 50%;
            }
        }
    </style>
</head>
<body>
    <div class="nav-container">
        <div class="navbar" id="navbar">
            <button title="Playground" data-page="playground" class="active">
                <i data-lucide="code"></i>
            </button>
            <button title="Tutorials" data-page="tutorials">
                <i data-lucide="book-open"></i>
            </button>
            <button title="Schema" data-page="schema">
                <i data-lucide="database"></i>
            </button>
            <button title="Examples" data-page="examples">
                <i data-lucide="list"></i>
            </button>
        </div>
        <div class="theme-toggle" id="theme-toggle">
            <button id="theme-button">
                <i data-lucide="sun"></i>
            </button>
        </div>
    </div>

    <div class="container">
        <div id="playground" class="page active">
            <div class="greeting">
                Ultimate SQL Playground <span>🚀</span>
            </div>
            <div class="description">
                Explore our bookstore database with basic SQL queries! Try the pre-loaded query, check out the Examples tab for more, and export results as CSV or charts as PNG. Learn SQL hands-on with no setup needed!
            </div>
            <div class="sql-editor-section">
                <h2>Write Your SQL Query</h2>
                <div class="sql-editor">
                    <textarea id="sql-input"></textarea>
                    <div class="buttons">
                        <button class="run-query" onclick="runQuery()">Run Query</button>
                        <button onclick="clearQuery()">Clear</button>
                        <button class="export-csv" onclick="exportCSV()">Export as CSV</button>
                        <button class="export-chart" onclick="exportChart()">Export Chart</button>
                    </div>
                    <div id="error-message" class="error-message"></div>
                </div>
            </div>
            <div class="result-section">
                <h2>Query Results</h2>
                <div class="result-tabs">
                    <button class="active" onclick="showResultTab('table')">Table</button>
                    <button onclick="showResultTab('chart')">Chart</button>
                </div>
                <table id="result-table" class="result-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
                <div id="result-chart" class="result-chart">
                    <canvas id="chart-canvas"></canvas>
                    <p id="chart-message" style="margin-top: 10px; font-size: 14px; color: #6b7280;"></p>
                </div>
            </div>
            <div class="history-section">
                <h2>Query History</h2>
                <div id="query-history"></div>
            </div>
        </div>

        <div id="tutorials" class="page">
            <div class="greeting">
                SQL Tutorials <span>📚</span>
            </div>
            <div class="description">
                Master SQL with our tutorials. From beginner basics to advanced techniques, each lesson includes explanations, examples, and challenges to test your skills.
            </div>
            <div class="tutorial-section">
                <h2>Beginner Tutorials</h2>
                <div class="tutorial">
                    <h3>1. Selecting Data with SELECT</h3>
                    <p>The SELECT statement retrieves data from a table. Use * to select all columns or specify columns for targeted data.</p>
                    <pre>SELECT title, price FROM books;</pre>
                    <div class="challenge">
                        <p><strong>Challenge:</strong> Select all columns from the books table where the price is less than 15.</p>
                        <button onclick="toggleSolution(this)">Show Solution</button>
                        <div class="solution">
                            <pre>SELECT * FROM books WHERE price < 15;</pre>
                        </div>
                    </div>
                </div>
                <div class="tutorial">
                    <h3>2. Filtering with WHERE</h3>
                    <p>The WHERE clause filters rows based on conditions. Combine with AND, OR, or LIKE for complex filters.</p>
                    <pre>SELECT title, publication_year FROM books WHERE publication_year > 2000 AND price < 20;</pre>
                    <div class="challenge">
                        <p><strong>Challenge:</strong> Find books with titles containing "Harry".</p>
                        <button onclick="toggleSolution(this)">Show Solution</button>
                        <div class="solution">
                            <pre>SELECT title FROM books WHERE title LIKE '%Harry%';</pre>
                        </div>
                    </div>
                </div>
                <h2>Intermediate Tutorials</h2>
                <div class="tutorial">
                    <h3>3. Joining Multiple Tables</h3>
                    <p>Use JOIN to combine data from multiple tables. INNER JOIN returns matching records, while LEFT JOIN includes all records from the left table.</p>
                    <pre>SELECT books.title, authors.name, publishers.name AS publisher
FROM books
INNER JOIN authors ON books.author_id = authors.author_id
INNER JOIN publishers ON books.publisher_id = publishers.publisher_id;</pre>
                    <div class="challenge">
                        <p><strong>Challenge:</strong> List all books with their authors and genres.</p>
                        <button onclick="toggleSolution(this)">Show Solution</button>
                        <div class="solution">
                            <pre>SELECT books.title, authors.name, genres.name AS genre
FROM books
INNER JOIN authors ON books.author_id = authors.author_id
INNER JOIN genres ON books.genre_id = genres.genre_id;</pre>
                        </div>
                    </div>
                </div>
                <div class="tutorial">
                    <h3>4. Aggregating Data with GROUP BY</h3>
                    <p>GROUP BY groups rows for aggregate functions like COUNT, SUM, AVG. Use HAVING to filter groups.</p>
                    <pre>SELECT genres.name, COUNT(*) as book_count
FROM books
INNER JOIN genres ON books.genre_id = genres.genre_id
GROUP BY genres.name
HAVING COUNT(*) > 2;</pre>
                    <div class="challenge">
                        <p><strong>Challenge:</strong> Find the average book price per publisher.</p>
                        <button onclick="toggleSolution(this)">Show Solution</button>
                        <div class="solution">
                            <pre>SELECT publishers.name, AVG(books.price) as avg_price
FROM books
INNER JOIN publishers ON books.publisher_id = publishers.publisher_id
GROUP BY publishers.name;</pre>
                        </div>
                    </div>
                </div>
                <h2>Advanced Tutorials</h2>
                <div class="tutorial">
                    <h3>5. Subqueries and CTEs</h3>
                    <p>Subqueries and Common Table Expressions (CTEs) allow complex queries. CTEs improve readability for nested queries.</p>
                    <pre>WITH top_rated AS (
    SELECT book_id, AVG(rating) as avg_rating
    FROM reviews
    GROUP BY book_id
    HAVING AVG(rating) > 4
)
SELECT books.title, top_rated.avg_rating
FROM books
INNER JOIN top_rated ON books.book_id = top_rated.book_id;</pre>
                    <div class="challenge">
                        <p><strong>Challenge:</strong> Find customers who placed orders worth more than the average order total.</p>
                        <button onclick="toggleSolution(this)">Show Solution</button>
                        <div class="solution">
                            <pre>WITH avg_order AS (
    SELECT AVG(total_amount) as avg_total
    FROM orders
)
SELECT customers.name, orders.total_amount
FROM orders
INNER JOIN customers ON orders.customer_id = customers.customer_id
WHERE orders.total_amount > (SELECT avg_total FROM avg_order);</pre>
                        </div>
                    </div>
                </div>
                <div class="tutorial">
                    <h3>6. Window Functions</h3>
                    <p>Window functions perform calculations across rows related to the current row, like ranking or running totals.</p>
                    <pre>SELECT title, price,
       RANK() OVER (PARTITION BY genre_id ORDER BY price DESC) as price_rank
FROM books;</pre>
                    <div class="challenge">
                        <p><strong>Challenge:</strong> Rank authors by the number of books they’ve written.</p>
                        <button onclick="toggleSolution(this)">Show Solution</button>
                        <div class="solution">
                            <pre>SELECT authors.name, 
       COUNT(books.book_id) as book_count,
       RANK() OVER (ORDER BY COUNT(books.book_id) DESC) as author_rank
FROM authors
LEFT JOIN books ON authors.author_id = books.author_id
GROUP BY authors.name;</pre>
                        </div>
                    </div>
                </div>
                <div class="tutorial">
                    <h3>7. Analyzing Stock Changes</h3>
                    <p>Use CASE statements and JOINs to analyze stock movements from the inventory_logs table.</p>
                    <pre>SELECT 
    g.name AS genre,
    SUM(CASE WHEN il.change_type = 'ADD' THEN il.quantity ELSE -il.quantity END) as net_stock_change
FROM genres g
INNER JOIN books b ON b.genre_id = g.genre_id
INNER JOIN inventory_logs il ON b.book_id = il.book_id
GROUP BY g.name
HAVING net_stock_change > 10
ORDER BY net_stock_change DESC;</pre>
                    <div class="challenge">
                        <p><strong>Challenge:</strong> Find the net stock change per book title.</p>
                        <button onclick="toggleSolution(this)">Show Solution</button>
                        <div class="solution">
                            <pre>SELECT 
    b.title,
    SUM(CASE WHEN il.change_type = 'ADD' THEN il.quantity ELSE -il.quantity END) as net_stock_change
FROM books b
INNER JOIN inventory_logs il ON b.book_id = il.book_id
GROUP BY b.title
ORDER BY net_stock_change DESC;</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="schema" class="page">
            <div class="greeting">
                Database Schema <span>🗄️</span>
            </div>
            <div class="description">
                Explore the bookstore database schema, including stock change logs. The diagram and table details below help you understand relationships and craft powerful queries.
            </div>
            <div class="schema-section">
                <h2>Schema Diagram</h2>
                <div class="schema-diagram">
                    <svg viewBox="0 0 600 500">
                        <rect x="20" y="20" width="100" height="80" fill="#34c759" rx="10"/>
                        <text x="70" y="60" fill="#ffffff" font-size="12" text-anchor="middle">books</text>
                        <rect x="160" y="20" width="100" height="80" fill="#0a84ff" rx="10"/>
                        <text x="210" y="60" fill="#ffffff" font-size="12" text-anchor="middle">authors</text>
                        <rect x="300" y="20" width="100" height="80" fill="#ff6b6b" rx="10"/>
                        <text x="350" y="60" fill="#ffffff" font-size="12" text-anchor="middle">publishers</text>
                        <rect x="440" y="20" width="100" height="80" fill="#ffca28" rx="10"/>
                        <text x="490" y="60" fill="#ffffff" font-size="12" text-anchor="middle">genres</text>
                        <rect x="20" y="140" width="100" height="80" fill="#6b7280" rx="10"/>
                        <text x="70" y="180" fill="#ffffff" font-size="12" text-anchor="middle">customers</text>
                        <rect x="160" y="140" width="100" height="80" fill="#2eb350" rx="10"/>
                        <text x="210" y="180" fill="#ffffff" font-size="12" text-anchor="middle">orders</text>
                        <rect x="300" y="140" width="100" height="80" fill="#096dd9" rx="10"/>
                        <text x="350" y="180" fill="#ffffff" font-size="12" text-anchor="middle">reviews</text>
                        <rect x="20" y="260" width="100" height="80" fill="#ff9500" rx="10"/>
                        <text x="70" y="300" fill="#ffffff" font-size="12" text-anchor="middle">inventory_logs</text>
                        <line x1="120" y1="60" x2="160" y2="60" stroke="#1a202c" stroke-width="2"/>
                        <line x1="260" y1="60" x2="300" y2="60" stroke="#1a202c" stroke-width="2"/>
                        <line x1="400" y1="60" x2="440" y2="60" stroke="#1a202c" stroke-width="2"/>
                        <line x1="120" y1="180" x2="160" y2="180" stroke="#1a202c" stroke-width="2"/>
                        <line x1="260" y1="180" x2="300" y2="180" stroke="#1a202c" stroke-width="2"/>
                        <line x1="70" y1="100" x2="70" y2="140" stroke="#1a202c" stroke-width="2"/>
                        <line x1="70" y1="220" x2="70" y2="260" stroke="#1a202c" stroke-width="2"/>
                    </svg>
                </div>
                <h2>Tables</h2>
                <div class="schema-table">
                    <h3>books</h3>
                    <p>Stores book details.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>book_id (INTEGER, Primary Key)</li>
                        <li>title (TEXT)</li>
                        <li>author_id (INTEGER, Foreign Key to authors)</li>
                        <li>publisher_id (INTEGER, Foreign Key to publishers)</li>
                        <li>genre_id (INTEGER, Foreign Key to genres)</li>
                        <li>price (REAL)</li>
                        <li>publication_year (INTEGER)</li>
                        <li>stock (INTEGER)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>book_id | title                   | author_id | publisher_id | genre_id | price | publication_year | stock
1       | The Great Gatsby        | 1         | 1           | 1        | 12.99 | 1925             | 50
2       | 1984                    | 2         | 2           | 2        | 15.50 | 1949             | 30
3       | Harry Potter and the Philosopher's Stone | 4 | 3 | 3 | 20.99 | 1997 | 100</pre>
                </div>
                <div class="schema-table">
                    <h3>authors</h3>
                    <p>Stores author details.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>author_id (INTEGER, Primary Key)</li>
                        <li>name (TEXT)</li>
                        <li>birth_year (INTEGER)</li>
                        <li>country (TEXT)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>author_id | name                | birth_year | country
1         | F. Scott Fitzgerald | 1896       | USA
2         | George Orwell       | 1903       | UK
3         | Jane Austen         | 1775       | UK</pre>
                </div>
                <div class="schema-table">
                    <h3>publishers</h3>
                    <p>Stores publisher details.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>publisher_id (INTEGER, Primary Key)</li>
                        <li>name (TEXT)</li>
                        <li>city (TEXT)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>publisher_id | name                | city
1            | Scribner            | New York
2            | Secker & Warburg    | London
3            | Bloomsbury          | London</pre>
                </div>
                <div class="schema-table">
                    <h3>genres</h3>
                    <p>Stores book genres.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>genre_id (INTEGER, Primary Key)</li>
                        <li>name (TEXT)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>genre_id | name
1        | Fiction
2        | Dystopian
3        | Fantasy</pre>
                </div>
                <div class="schema-table">
                    <h3>customers</h3>
                    <p>Stores customer details.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>customer_id (INTEGER, Primary Key)</li>
                        <li>name (TEXT)</li>
                        <li>email (TEXT)</li>
                        <li>join_date (TEXT)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>customer_id | name           | email                | join_date
1           | Alice Smith    | alice@example.com    | 2023-01-15
2           | Bob Johnson    | bob@example.com      | 2023-02-10</pre>
                </div>
                <div class="schema-table">
                    <h3>orders</h3>
                    <p>Stores order details.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>order_id (INTEGER, Primary Key)</li>
                        <li>customer_id (INTEGER, Foreign Key to customers)</li>
                        <li>book_id (INTEGER, Foreign Key to books)</li>
                        <li>order_date (TEXT)</li>
                        <li>quantity (INTEGER)</li>
                        <li>total_amount (REAL)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>order_id | customer_id | book_id | order_date  | quantity | total_amount
1        | 1          | 1       | 2023-03-01  | 2        | 25.98
2        | 2          | 2       | 2023-03-02  | 1        | 15.50</pre>
                </div>
                <div class="schema-table">
                    <h3>reviews</h3>
                    <p>Stores book reviews.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>review_id (INTEGER, Primary Key)</li>
                        <li>book_id (INTEGER, Foreign Key to books)</li>
                        <li>customer_id (INTEGER, Foreign Key to customers)</li>
                        <li>rating (INTEGER)</li>
                        <li>comment (TEXT)</li>
                        <li>review_date (TEXT)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>review_id | book_id | customer_id | rating | comment                | review_date
1         | 1       | 1          | 5      | Amazing read!          | 2023-03-05
2         | 2       | 2          | 4      | Thought-provoking      | 2023-03-06</pre>
                </div>
                <div class="schema-table">
                    <h3>inventory_logs</h3>
                    <p>Stores stock change logs for books.</p>
                    <p><strong>Columns:</strong></p>
                    <ul>
                        <li>log_id (INTEGER, Primary Key)</li>
                        <li>book_id (INTEGER, Foreign Key to books)</li>
                        <li>change_type (TEXT, 'ADD' or 'REMOVE')</li>
                        <li>quantity (INTEGER)</li>
                        <li>log_date (TEXT)</li>
                    </ul>
                    <p><strong>Sample Data:</strong></p>
                    <pre>log_id | book_id | change_type | quantity | log_date
1      | 1       | ADD         | 20       | 2023-03-01
2      | 2       | REMOVE      | 5        | 2023-03-02
3      | 4       | ADD         | 50       | 2023-03-03</pre>
                </div>
            </div>
        </div>

        <div id="examples" class="page">
            <div class="greeting">
                Example Queries <span>📋</span>
            </div>
            <div class="description">
                Try these basic SQL queries to explore the bookstore database. Click "Run Query" to load each query into the editor, then execute it to see results in a table or chart. Export results as CSV or charts as PNG!
            </div>
            <div class="examples-section">
                <h2>Basic Queries</h2>
                <div class="example-query">
                    <h3>1. List All Books</h3>
                    <p>Retrieve all columns from the books table to see titles, prices, and more.</p>
                    <pre>SELECT * FROM books;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT * FROM books;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>2. Books Under $15</h3>
                    <p>Find books with a price less than $15, showing title and price.</p>
                    <pre>SELECT title, price FROM books WHERE price < 15;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT title, price FROM books WHERE price < 15;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>3. Books by Genre</h3>
                    <p>List books in the Fantasy genre, joining with the genres table.</p>
                    <pre>SELECT b.title, g.name AS genre
FROM books b
INNER JOIN genres g ON b.genre_id = g.genre_id
WHERE g.name = 'Fantasy';</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT b.title, g.name AS genre\nFROM books b\nINNER JOIN genres g ON b.genre_id = g.genre_id\nWHERE g.name = \'Fantasy\';')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>4. Books with Authors</h3>
                    <p>Join books and authors to show book titles and author names.</p>
                    <pre>SELECT b.title, a.name AS author
FROM books b
INNER JOIN authors a ON b.author_id = a.author_id;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT b.title, a.name AS author\nFROM books b\nINNER JOIN authors a ON b.author_id = a.author_id;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>5. Sort Books by Price</h3>
                    <p>List books sorted by price in descending order.</p>
                    <pre>SELECT title, price FROM books ORDER BY price DESC;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT title, price FROM books ORDER BY price DESC;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>6. Count Books per Genre</h3>
                    <p>Count the number of books in each genre (produces a chart).</p>
                    <pre>SELECT g.name AS genre, COUNT(*) AS book_count
FROM genres g
INNER JOIN books b ON b.genre_id = g.genre_id
GROUP BY g.name;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT g.name AS genre, COUNT(*) AS book_count\nFROM genres g\nINNER JOIN books b\nON b.genre_id = g.genre_id\nGROUP BY g.name;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>7. Average Book Price by Publisher</h3>
                    <p>Calculate the average book price for each publisher (produces a chart).</p>
                    <pre>SELECT p.name AS publisher, AVG(b.price) AS avg_price
FROM publishers p
INNER JOIN books b ON b.publisher_id = p.publisher_id
GROUP BY p.name;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT p.name AS publisher, AVG(b.price) AS avg_price\nFROM publishers p\nINNER JOIN books b\nON b.publisher_id = p.publisher_id\nGROUP BY p.name;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>8. Net Stock Change by Genre</h3>
                    <p>Analyze net stock changes (ADD minus REMOVE) per genre (produces a chart).</p>
                    <pre>SELECT 
    g.name AS genre,
    SUM(CASE WHEN il.change_type = 'ADD' THEN il.quantity ELSE -il.quantity END) AS net_stock_change
FROM genres g
INNER JOIN books b ON b.genre_id = g.genre_id
INNER JOIN inventory_logs il ON b.book_id = il.book_id
GROUP BY g.name
HAVING net_stock_change > 0;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT \n    g.name AS genre,\n    SUM(CASE WHEN il.change_type = \'ADD\' THEN il.quantity ELSE -il.quantity END) AS net_stock_change\nFROM genres g\nINNER JOIN books b\nON b.genre_id = g.genre_id\nINNER JOIN inventory_logs il ON b.book_id = il.book_id\nGROUP BY g.name\nHAVING net_stock_change > 0;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>9. Customer Orders</h3>
                    <p>List all orders with customer names and book titles.</p>
                    <pre>SELECT c.name AS customer, b.title, o.order_date
FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id
INNER JOIN books b ON o.book_id = b.book_id;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT c.name AS customer, b.title, o.order_date\nFROM orders o\nINNER JOIN customers c ON o.customer_id = c.customer_id\nINNER JOIN books b ON o.book_id = b.book_id;')">Run Query</button>
                </div>
                <div class="example-query">
                    <h3>10. High-Rated Reviews</h3>
                    <p>Find reviews with a rating of 5, showing book titles and comments.</p>
                    <pre>SELECT b.title, r.comment, r.rating
FROM reviews r
INNER JOIN books b ON r.book_id = b.book_id
WHERE r.rating = 5;</pre>
                    <button class="run-button" onclick="runExampleQuery('SELECT b.title, r.comment, r.rating\nFROM reviews r\nINNER JOIN books b ON r.book_id = b.book_id\nWHERE r.rating = 5;')">Run Query</button>
                </div>
            </div>
        </div>
    </div>

    <footer>© 2025 Ultimate SQL Playground | Built with 💻 for SQL enthusiasts</footer>

    <script>
        lucide.createIcons();

        let db;
        let editor;
        let chart;
        let queryHistory = JSON.parse(localStorage.getItem('sqlQueryHistory')) || [];

        async function initDatabase() {
            const SQL = await initSqlJs({
                locateFile: file => `https://cdn.jsdelivr.net/npm/sql.js@1.8.0/dist/${file}`
            });

            db = new SQL.Database();

            // Create tables and insert expanded sample data
            db.run(`
                CREATE TABLE authors (
                    author_id INTEGER PRIMARY KEY,
                    name TEXT,
                    birth_year INTEGER,
                    country TEXT
                );
                CREATE TABLE publishers (
                    publisher_id INTEGER PRIMARY KEY,
                    name TEXT,
                    city TEXT
                );
                CREATE TABLE genres (
                    genre_id INTEGER PRIMARY KEY,
                    name TEXT
                );
                CREATE TABLE books (
                    book_id INTEGER PRIMARY KEY,
                    title TEXT,
                    author_id INTEGER,
                    publisher_id INTEGER,
                    genre_id INTEGER,
                    price REAL,
                    publication_year INTEGER,
                    stock INTEGER,
                    FOREIGN KEY (author_id) REFERENCES authors(author_id),
                    FOREIGN KEY (publisher_id) REFERENCES publishers(publisher_id),
                    FOREIGN KEY (genre_id) REFERENCES genres(genre_id)
                );
                CREATE TABLE customers (
                    customer_id INTEGER PRIMARY KEY,
                    name TEXT,
                    email TEXT,
                    join_date TEXT
                );
                CREATE TABLE orders (
                    order_id INTEGER PRIMARY KEY,
                    customer_id INTEGER,
                    book_id INTEGER,
                    order_date TEXT,
                    quantity INTEGER,
                    total_amount REAL,
                    FOREIGN KEY (customer_id) REFERENCES customers(customer_id),
                    FOREIGN KEY (book_id) REFERENCES books(book_id)
                );
                CREATE TABLE reviews (
                    review_id INTEGER PRIMARY KEY,
                    book_id INTEGER,
                    customer_id INTEGER,
                    rating INTEGER,
                    comment TEXT,
                    review_date TEXT,
                    FOREIGN KEY (book_id) REFERENCES books(book_id),
                    FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
                );
                CREATE TABLE inventory_logs (
                    log_id INTEGER PRIMARY KEY,
                    book_id INTEGER,
                    change_type TEXT,
                    quantity INTEGER,
                    log_date TEXT,
                    FOREIGN KEY (book_id) REFERENCES books(book_id)
                );

                INSERT INTO authors (author_id, name, birth_year, country) VALUES
                    (1, 'F. Scott Fitzgerald', 1896, 'USA'),
                    (2, 'George Orwell', 1903, 'UK'),
                    (3, 'Jane Austen', 1775, 'UK'),
                    (4, 'J.K. Rowling', 1965, 'UK'),
                    (5, 'Agatha Christie', 1890, 'UK'),
                    (6, 'Ernest Hemingway', 1899, 'USA'),
                    (7, 'Toni Morrison', 1931, 'USA'),
                    (8, 'Mark Twain', 1835, 'USA'),
                    (9, 'Charles Dickens', 1812, 'UK'),
                    (10, 'Leo Tolstoy', 1828, 'Russia');

                INSERT INTO publishers (publisher_id, name, city) VALUES
                    (1, 'Scribner', 'New York'),
                    (2, 'Secker & Warburg', 'London'),
                    (3, 'Bloomsbury', 'London'),
                    (4, 'Penguin', 'London'),
                    (5, 'HarperCollins', 'New York'),
                    (6, 'Random House', 'New York'),
                    (7, 'Macmillan', 'London'),
                    (8, 'Hachette', 'Paris'),
                    (9, 'Simon & Schuster', 'New York'),
                    (10, 'Oxford University Press', 'Oxford');

                INSERT INTO genres (genre_id, name) VALUES
                    (1, 'Fiction'),
                    (2, 'Dystopian'),
                    (3, 'Fantasy'),
                    (4, 'Mystery'),
                    (5, 'Romance'),
                    (6, 'Historical'),
                    (7, 'Science Fiction'),
                    (8, 'Thriller'),
                    (9, 'Biography'),
                    (10, 'Adventure');

                INSERT INTO books (book_id, title, author_id, publisher_id, genre_id, price, publication_year, stock) VALUES
                    (1, 'The Great Gatsby', 1, 1, 1, 12.99, 1925, 50),
                    (2, '1984', 2, 2, 2, 15.50, 1949, 30),
                    (3, 'Pride and Prejudice', 3, 4, 5, 10.99, 1813, 40),
                    (4, 'Harry Potter and the Philosopher''s Stone', 4, 3, 3, 20.99, 1997, 100),
                    (5, 'Murder on the Orient Express', 5, 5, 4, 14.99, 1934, 60),
                    (6, 'Animal Farm', 2, 2, 2, 11.50, 1945, 25),
                    (7, 'The Old Man and the Sea', 6, 1, 1, 13.99, 1952, 35),
                    (8, 'Beloved', 7, 5, 1, 16.99, 1987, 20),
                    (9, 'Sense and Sensibility', 3, 4, 5, 11.99, 1811, 45),
                    (10, 'Death on the Nile', 5, 5, 4, 14.50, 1937, 55),
                    (11, 'Adventures of Huckleberry Finn', 8, 6, 10, 9.99, 1884, 70),
                    (12, 'A Tale of Two Cities', 9, 7, 6, 8.99, 1859, 80),
                    (13, 'War and Peace', 10, 8, 6, 19.99, 1869, 15),
                    (14, 'The Adventures of Tom Sawyer', 8, 6, 10, 7.99, 1876, 65),
                    (15, 'Great Expectations', 9, 7, 6, 10.50, 1861, 50);

                INSERT INTO customers (customer_id, name, email, join_date) VALUES
                    (1, 'Alice Smith', 'alice@example.com', '2023-01-15'),
                    (2, 'Bob Johnson', 'bob@example.com', '2023-02-10'),
                    (3, 'Carol White', 'carol@example.com', '2023-03-01'),
                    (4, 'David Brown', 'david@example.com', '2023-04-05'),
                    (5, 'Eve Davis', 'eve@example.com', '2023-05-10'),
                    (6, 'Frank Wilson', 'frank@example.com', '2023-06-15'),
                    (7, 'Grace Lee', 'grace@example.com', '2023-07-20'),
                    (8, 'Hank Miller', 'hank@example.com', '2023-08-25'),
                    (9, 'Ivy Taylor', 'ivy@example.com', '2023-09-30'),
                    (10, 'Jack Moore', 'jack@example.com', '2023-10-05');

                INSERT INTO orders (order_id, customer_id, book_id, order_date, quantity, total_amount) VALUES
                    (1, 1, 1, '2023-03-01', 2, 25.98),
                    (2, 2, 2, '2023-03-02', 1, 15.50),
                    (3, 3, 4, '2023-03-03', 3, 62.97),
                    (4, 4, 5, '2023-03-04', 1, 14.99),
                    (5, 1, 7, '2023-03-05', 2, 27.98),
                    (6, 5, 11, '2023-03-06', 1, 9.99),
                    (7, 6, 12, '2023-03-07', 2, 17.98),
                    (8, 7, 13, '2023-03-08', 1, 19.99),
                    (9, 8, 14, '2023-03-09', 3, 23.97),
                    (10, 9, 15, '2023-03-10', 1, 10.50);

                INSERT INTO reviews (review_id, book_id, customer_id, rating, comment, review_date) VALUES
                    (1, 1, 1, 5, 'Amazing read!', '2023-03-05'),
                    (2, 2, 2, 4, 'Thought-provoking', '2023-03-06'),
                    (3, 4, 3, 5, 'Magical adventure', '2023-03-07'),
                    (4, 5, 4, 4, 'Classic mystery', '2023-03-08'),
                    (5, 7, 1, 5, 'Beautifully written', '2023-03-09'),
                    (6, 11, 5, 5, 'Timeless classic!', '2023-03-10'),
                    (7, 12, 6, 4, 'Engaging story', '2023-03-11'),
                    (8, 13, 7, 5, 'Masterpiece!', '2023-03-12'),
                    (9, 14, 8, 4, 'Fun and adventurous', '2023-03-13'),
                    (10, 15, 9, 5, 'A must-read!', '2023-03-14');

                INSERT INTO inventory_logs (log_id, book_id, change_type, quantity, log_date) VALUES
                    (1, 1, 'ADD', 20, '2023-03-01'),
                    (2, 2, 'REMOVE', 5, '2023-03-02'),
                    (3, 4, 'ADD', 50, '2023-03-03'),
                    (4, 5, 'REMOVE', 10, '2023-03-04'),
                    (5, 1, 'ADD', 15, '2023-03-05'),
                    (6, 7, 'REMOVE', 8, '2023-03-06'),
                    (7, 4, 'ADD', 30, '2023-03-07'),
                    (8, 11, 'ADD', 25, '2023-03-08'),
                    (9, 12, 'REMOVE', 10, '2023-03-09'),
                    (10, 13, 'ADD', 5, '2023-03-10');
            `);
        }

        function initEditor() {
            const textarea = document.getElementById('sql-input');
            editor = CodeMirror.fromTextArea(textarea, {
                mode: 'sql',
                theme: document.body.classList.contains('dark-mode') ? 'monokai' : 'default',
                lineNumbers: true,
                autofocus: true,
                matchBrackets: true,
                autoCloseBrackets: true,
                hintOptions: {
                    tables: {
                        books: ['book_id', 'title', 'author_id', 'publisher_id', 'genre_id', 'price', 'publication_year', 'stock'],
                        authors: ['author_id', 'name', 'birth_year', 'country'],
                        publishers: ['publisher_id', 'name', 'city'],
                        genres: ['genre_id', 'name'],
                        customers: ['customer_id', 'name', 'email', 'join_date'],
                        orders: ['order_id', 'customer_id', 'book_id', 'order_date', 'quantity', 'total_amount'],
                        reviews: ['review_id', 'book_id', 'customer_id', 'rating', 'comment', 'review_date'],
                        inventory_logs: ['log_id', 'book_id', 'change_type', 'quantity', 'log_date']
                    }
                },
                value: `SELECT 
    g.name AS genre,
    COUNT(*) AS book_count
FROM genres g
INNER JOIN books b ON b.genre_id = g.genre_id
GROUP BY g.name;`
            });
            editor.setSize('100%', '200px');
        }

        function runQuery() {
            const sqlInput = editor.getValue().trim();
            const resultTable = document.getElementById('result-table');
            const errorMessage = document.getElementById('error-message');
            const chartDiv = document.getElementById('result-chart');
            const chartMessage = document.getElementById('chart-message');

            // Clear previous results, errors, and chart
            resultTable.querySelector('thead').innerHTML = '';
            resultTable.querySelector('tbody').innerHTML = '';
            errorMessage.textContent = '';
            chartDiv.style.display = 'none';
            chartMessage.textContent = '';
            if (chart) chart.destroy();

            if (!sqlInput) {
                errorMessage.textContent = 'Please enter a SQL query.';
                return;
            }

            try {
                const results = db.exec(sqlInput);

                // Save to history
                queryHistory.unshift({ query: sqlInput, timestamp: new Date().toLocaleString() });
                if (queryHistory.length > 10) queryHistory.pop();
                localStorage.setItem('sqlQueryHistory', JSON.stringify(queryHistory));
                updateQueryHistory();

                if (results.length === 0) {
                    errorMessage.textContent = 'Query executed successfully, but no results returned.';
                    return;
                }

                const columns = results[0].columns;
                const values = results[0].values;

                // Populate table
                const thead = resultTable.querySelector('thead');
                const headerRow = document.createElement('tr');
                columns.forEach(col => {
                    const th = document.createElement('th');
                    th.textContent = col;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                const tbody = resultTable.querySelector('tbody');
                values.forEach(row => {
                    const tr = document.createElement('tr');
                    row.forEach(cell => {
                        const td = document.createElement('td');
                        td.textContent = cell === null ? 'NULL' : cell;
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

                // Check if the query can generate a chart
                if (columns.length === 2 && values.length > 0 && !isNaN(values[0][1])) {
                    const labels = values.map(row => row[0]);
                    const data = values.map(row => row[1]);
                    const ctx = document.getElementById('chart-canvas').getContext('2d');
                    chart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: columns[1],
                                data: data,
                                backgroundColor: '#34c759',
                                borderColor: '#2eb350',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                    chartDiv.style.display = 'block';
                    chartMessage.textContent = 'Chart generated successfully.';
                } else {
                    chartMessage.textContent = 'This query cannot generate a chart. Ensure it returns exactly two columns, with the second column being numeric.';
                }
            } catch (error) {
                errorMessage.textContent = `Error: ${error.message}`;
            }
        }

        function clearQuery() {
            editor.setValue('');
            document.getElementById('result-table').querySelector('thead').innerHTML = '';
            document.getElementById('result-table').querySelector('tbody').innerHTML = '';
            document.getElementById('error-message').textContent = '';
            if (chart) chart.destroy();
        }

        function exportCSV() {
            const table = document.getElementById('result-table');
            if (!table.querySelector('thead').children.length) {
                alert('No table data to export.');
                return;
            }

            const rows = [];
            const headers = Array.from(table.querySelectorAll('thead tr th')).map(th => th.textContent);
            rows.push(headers.join(','));

            const bodyRows = table.querySelectorAll('tbody tr');
            bodyRows.forEach(row => {
                const cells = Array.from(row.querySelectorAll('td')).map(td => `"${td.textContent.replace(/"/g, '""')}"`);
                rows.push(cells.join(','));
            });

            const csv = rows.join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'query_results.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportChart() {
            if (!chart) {
                alert('No chart available to export.');
                return;
            }

            const canvas = document.getElementById('chart-canvas');
            const url = canvas.toDataURL('image/png');
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chart.png';
            a.click();
        }

        function runExampleQuery(query) {
            editor.setValue(query);
            document.querySelector('.navbar button[data-page="playground"]').click();
            // Optionally, auto-run the query
            runQuery();
        }

        function showResultTab(tab) {
            const table = document.getElementById('result-table');
            const chartDiv = document.getElementById('result-chart');
            const buttons = document.querySelectorAll('.result-tabs button');

            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.result-tabs button[onclick="showResultTab('${tab}')"]`).classList.add('active');

            if (tab === 'table') {
                table.style.display = 'block';
                chartDiv.style.display = 'none';
            } else {
                table.style.display = 'none';
                chartDiv.style.display = 'block';
            }
        }

        function updateQueryHistory() {
            const historyDiv = document.getElementById('query-history');
            historyDiv.innerHTML = '';
            queryHistory.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <pre>${item.query}</pre>
                    <div class="buttons">
                        <button onclick="loadQuery(${index})">Load</button>
                        <button onclick="deleteQuery(${index})">Delete</button>
                    </div>
                `;
                historyDiv.appendChild(div);
            });
        }

        function loadQuery(index) {
            editor.setValue(queryHistory[index].query);
        }

        function deleteQuery(index) {
            queryHistory.splice(index, 1);
            localStorage.setItem('sqlQueryHistory', JSON.stringify(queryHistory));
            updateQueryHistory();
        }

        function toggleSolution(button) {
            const solution = button.nextElementSibling;
            solution.style.display = solution.style.display === 'block' ? 'none' : 'block';
        }

        document.querySelectorAll('.navbar button').forEach(button => {
            button.addEventListener('click', () => {
                const page = button.dataset.page;
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(page).classList.add('active');
                document.querySelectorAll('.navbar button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            });
        });

        document.getElementById('theme-button').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            editor.setOption('theme', document.body.classList.contains('dark-mode') ? 'monokai' : 'default');
        });

        initDatabase();
        initEditor();
        updateQueryHistory();
    </script>
</body>
</html>